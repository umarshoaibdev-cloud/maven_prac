pipeline
{
  agent any
  stages
  {
    stage('Download')
    {
      steps
      {
        script
        {
          try
          {
            git 'https://github.com/IntelliqDevops/maven.git'
          }
          catch(Exception e1)
          {
            echo 'Download failed'
            exit(1)
          }
        }
      }
    }
    stage('Build')
    {
      steps
      {
        script
        {
          try
          {
            sh 'mvn package'
          }
          catch(Exception e2)
          {
            mail bcc: '', body: 'Jenkins unable to build the war file', cc: '', from: '', replyTo: '', subject: 'Build Failed', to: 'Dev.team@gmail.com'
            exit(1)
          }
        }
      }
    }
    stage('Deployment')
    {
      steps
      {
        script
        {
          try
          {
            sh 'scp /var/lib/jenkins/workspace/DeclarativePipelineExceptionHandling/webapp/target/webapp.war ubuntu@172.31.7.54:/var/lib/tomcat10/webapps/testapp.war'
          }
          catch(Exception e3)
          {
            mail bcc: '', body: 'Jenkins unable to deploy the war file', cc: '', from: '', replyTo: '', subject: 'Deployement Failed', to: 'middleware.team@gmail.com'
            exit(1)
          }
        }
      }
    }
    stage('Testing')
    {
      steps
      {
        script
        {
          try
          {
            git 'https://github.com/IntelliqDevops/FunctionalTesting.git'
            sh 'java -jar /var/lib/jenkins/workspace/DeclarativePipelineExceptionHandling/testing.jar'
          }
          catch(Exception e4)
          {
            mail bcc: '', body: 'Jenkins unable to deploy the war file', cc: '', from: '', replyTo: '', subject: 'Deployement Failed', to: 'middleware.team@gmail.com'
            exit(1) 
          }
        }
      }
    }
    stage('Delivery')
    {
      steps
      {
        script
        {
          try
          {
            sh 'scp /var/lib/jenkins/workspace/DeclarativePipelineExceptionHandling/webapp/target/webapp.war  ubuntu@172.31.14.227:/var/lib/tomcat10/webapps/prodapp.war'
          }
          catch(Exception e5)
          {
            mail bcc: '', body: 'Jenkins unable to deliver the war file', cc: '', from: '', replyTo: '', subject: 'Deployement Failed', to: 'middleware.team@gmail.com'
            exit(1)
          }
        }
      }
    }
  }
}
